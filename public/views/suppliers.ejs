<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asesores de marca</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-0">Asesores de marca</h1>
            <button id="openCreateBtn"
                class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center justify-center transition-colors">
                <i class="fas fa-plus mr-2"></i> Añadir Proveedor
            </button>
        </div>

        <% if (success && success.length> 0) { %>
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4 flex items-center">
                <i class="fas fa-check-circle mr-2"></i>
                <%= success %>
            </div>
            <% } %>
                <% if (error && error.length> 0) { %>
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 flex items-center">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        <%= error %>
                    </div>
                    <% } %>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-6">
                            <form action="/suppliers" method="GET"
                                class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 items-center">
                                <div class="relative w-full lg:col-span-2">
                                    <input type="text" name="search" placeholder="Buscar por marca, nombre, etc."
                                        value="<%= searchQuery %>"
                                        class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-search text-gray-400"></i>
                                    </div>
                                </div>
                                <select name="category"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white">
                                    <option value="">Categoría</option>
                                    <% categories.forEach(cat=> { %>
                                        <option value="<%= cat %>" <%=categoryFilter===cat ? 'selected' : '' %>>
                                            <%= cat %>
                                        </option>
                                        <% }); %>
                                </select>
                                <select name="city"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white">
                                    <option value="">Ciudad</option>
                                    <% cities.forEach(city=> { %>
                                        <option value="<%= city.name %>" <%=cityFilter===city.name ? 'selected' : '' %>>
                                            <%= city.name %>
                                        </option>
                                        <% }); %>
                                </select>
                                <div class="flex w-full gap-2 lg:col-span-2">
                                    <button type="submit"
                                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition-colors flex-grow flex items-center justify-center">
                                        <i class="fas fa-filter mr-2"></i> Filtrar
                                    </button>
                                    <a href="/suppliers"
                                        class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-lg transition-colors flex-grow flex items-center justify-center">
                                        Limpiar
                                    </a>
                                </div>
                            </form>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden hidden md:block">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                Imagen</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                Marca</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                Categoría</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                Nombre</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                Celular</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                Tipo Asesor</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                Empresa</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                Ciudad</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                Nota</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody
                                        class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <% if (suppliers.length===0) { %>
                                            <tr>
                                                <td colspan="8"
                                                    class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">No se
                                                    encontraron asesores de marca.</td>
                                            </tr>
                                            <% } else { %>
                                                <% suppliers.forEach(supplier=> { %>
                                                    <tr
                                                        class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                                        <td class="px-6 py-4 whitespace-nowrap">
                                                            <% if (supplier.imagen) { %>
                                                                <img src="<%= supplier.imagen %>" alt="Imagen"
                                                                    class="h-10 w-10 rounded-full object-cover shadow">
                                                                <% } else { %>
                                                                    <div
                                                                        class="h-10 w-10 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center shadow">
                                                                        <i
                                                                            class="fas fa-image text-gray-600 dark:text-gray-400"></i>
                                                                    </div>
                                                                    <% } %>
                                                        </td>
                                                        <td
                                                            class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                            <%= supplier.marca %>
                                                        </td>
                                                        <td
                                                            class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                            <%= supplier.categoria %>
                                                        </td>
                                                        <td
                                                            class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                            <%= supplier.nombre %>
                                                        </td>
                                                        <td
                                                            class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                            <%= supplier.celular %>
                                                        </td>
                                                        <td
                                                            class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                            <%= supplier.tipoAsesor %>
                                                        </td>
                                                        <td
                                                            class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                            <%= supplier.nombreEmpresa || 'N/A' %>
                                                        </td>
                                                        <td
                                                            class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                            <%= supplier.ciudad %>
                                                        </td>
                                                        <td
                                                            class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                            <%= supplier.nota %>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <button
                                                                class="edit-btn text-blue-600 hover:text-blue-900 mr-3 transition-colors"
                                                                title="Editar" data-id="<%= supplier.id %>"
                                                                data-marca="<%= supplier.marca %>"
                                                                data-categoria="<%= supplier.categoria %>"
                                                                data-nombre="<%= supplier.nombre %>"
                                                                data-celular="<%= supplier.celular %>"
                                                                data-tipo-asesor="<%= supplier.tipoAsesor %>"
                                                                data-nombre-empresa="<%= supplier.nombreEmpresa %>"
                                                                data-ciudad="<%= supplier.ciudad %>"
                                                                data-nota="<%= supplier.nota %>"
                                                                data-imagen="<%= supplier.imagen %>">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                            <button
                                                                class="delete-btn text-red-600 hover:text-red-900 transition-colors"
                                                                title="Eliminar" data-id="<%= supplier.id %>"
                                                                data-nombre="<%= supplier.nombre %>">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <% }); %>
                                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div
                            class="bg-white dark:bg-gray-800 rounded-lg shadow md:hidden divide-y divide-gray-200 dark:divide-gray-700">
                            <% if (suppliers.length===0) { %>
                                <p class="p-4 text-center text-gray-500 dark:text-gray-400">No se encontraron
                                    asesores de marca.</p>
                                <% } else { %>
                                    <% suppliers.forEach(supplier=> { %>
                                        <div class="p-4">
                                            <div class="flex items-center mb-2">
                                                <% if (supplier.imagen) { %>
                                                    <img src="<%= supplier.imagen %>" alt="Imagen"
                                                        class="h-12 w-12 rounded-full object-cover mr-4">
                                                    <% } else { %>
                                                        <div
                                                            class="h-12 w-12 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center mr-4">
                                                            <i
                                                                class="fas fa-image text-gray-600 dark:text-gray-400"></i>
                                                        </div>
                                                        <% } %>
                                                            <div>
                                                                <p
                                                                    class="text-lg font-semibold text-gray-900 dark:text-white">
                                                                    <%= supplier.nombre %>
                                                                </p>
                                                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                                                    <%= supplier.marca %>
                                                                </p>
                                                            </div>
                                            </div>
                                            <div
                                                class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-gray-600 dark:text-gray-400 mt-2">
                                                <div><strong>Categoría:</strong>
                                                    <%= supplier.categoria %>
                                                </div>
                                                <div><strong>Celular:</strong>
                                                    <%= supplier.celular %>
                                                </div>
                                                <div><strong>Tipo Asesor:</strong>
                                                    <%= supplier.tipoAsesor %>
                                                </div>
                                                <div><strong>Empresa:</strong>
                                                    <%= supplier.nombreEmpresa || 'N/A' %>
                                                </div>
                                                <div><strong>Ciudad:</strong>
                                                    <%= supplier.ciudad %>
                                                </div>
                                                <div><strong>Nota:</strong>
                                                    <%= supplier.nota || 'N/A' %>
                                                </div>
                                            </div>
                                            <div class="flex justify-end mt-4 space-x-2">
                                                <button
                                                    class="edit-btn text-blue-600 hover:text-blue-900 transition-colors flex items-center"
                                                    title="Editar" data-id="<%= supplier.id %>"
                                                    data-marca="<%= supplier.marca %>"
                                                    data-categoria="<%= supplier.categoria %>"
                                                    data-nombre="<%= supplier.nombre %>"
                                                    data-celular="<%= supplier.celular %>"
                                                    data-tipo-asesor="<%= supplier.tipoAsesor %>"
                                                    data-nombre-empresa="<%= supplier.nombreEmpresa %>"
                                                    data-ciudad="<%= supplier.ciudad %>"
                                                    data-nota="<%= supplier.nota %>"
                                                    data-imagen="<%= supplier.imagen %>">
                                                    <i class="fas fa-edit mr-1"></i> Editar
                                                </button>
                                                <button
                                                    class="delete-btn text-red-600 hover:text-red-900 transition-colors flex items-center"
                                                    title="Eliminar" data-id="<%= supplier.id %>"
                                                    data-nombre="<%= supplier.nombre %>">
                                                    <i class="fas fa-trash mr-1"></i> Eliminar
                                                </button>
                                            </div>
                                        </div>
                                        <% }); %>
                                            <% } %>
                        </div>

                        <% if (totalPages> 1) { %>
                            <div
                                class="mt-8 flex justify-center items-center space-x-2 text-gray-700 dark:text-gray-300">
                                <% if (currentPage> 1) { %>
                                    <a href="/suppliers?page=<%= currentPage - 1 %>&search=<%= searchQuery %>&category=<%= categoryFilter %>&city=<%= cityFilter %>"
                                        class="px-3 py-1 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                                        Anterior
                                    </a>
                                    <% } %>
                                        <% for (let i=1; i <=totalPages; i++) { %>
                                            <a href="/suppliers?page=<%= i %>&search=<%= searchQuery %>&category=<%= categoryFilter %>&city=<%= cityFilter %>"
                                                class="px-3 py-1 rounded-lg <%= i === currentPage ? 'bg-indigo-600 text-white' : 'bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600' %> transition-colors">
                                                <%= i %>
                                            </a>
                                            <% } %>
                                                <% if (currentPage < totalPages) { %>
                                                    <a href="/suppliers?page=<%= currentPage + 1 %>&search=<%= searchQuery %>&category=<%= categoryFilter %>&city=<%= cityFilter %>"
                                                        class="px-3 py-1 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                                                        Siguiente
                                                    </a>
                                                    <% } %>
                            </div>
                            <% } %>
    </div>

    <div id="supplierModal"
        class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 fade-in">
        <div
            class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white dark:bg-gray-800 slide-down">
            <div class="flex justify-between items-center pb-4 border-b dark:border-gray-700">
                <h3 id="modalTitle" class="text-2xl font-bold text-gray-900 dark:text-white"></h3>
                <button id="closeModalIconBtn"
                    class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="supplierForm" action="/api/suppliers" method="POST" enctype="multipart/form-data" class="mt-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="marca" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Marca
                            *</label>
                        <input type="text" name="marca" id="marca" required
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                        <p id="marcaError" class="error-message hidden">Este campo es obligatorio.</p>
                    </div>
                    <div>
                        <label for="categoria"
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Categoría *</label>
                        <input type="text" name="categoria" id="categoria" required
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                        <p id="categoriaError" class="error-message hidden">Este campo es obligatorio.</p>
                    </div>
                </div>
                <div class="mb-4">
                    <label for="nombre" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nombre
                        *</label>
                    <input type="text" name="nombre" id="nombre" required
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                    <p id="nombreError" class="error-message hidden">Este campo es obligatorio.</p>
                </div>
                <div class="mb-4">
                    <label for="celular" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Celular
                        *</label>
                    <input type="tel" name="celular" id="celular" required maxlength="10"
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white transition-colors"
                        placeholder="10 dígitos sin espacios">
                    <p id="celularError" class="error-message hidden">Debe contener exactamente 10 dígitos numéricos.
                    </p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Debe contener exactamente 10 dígitos
                        numéricos</p>
                </div>
                <div class="mb-4">
                    <label for="tipoAsesor" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tipo
                        de Asesor *</label>
                    <select name="tipoAsesor" id="tipoAsesor" required
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                        <option value="">Seleccione el tipo de asesor</option>
                        <option value="Representante de Fabrica">Representante de Fábrica</option>
                        <option value="Mayorista">Mayorista</option>
                        <option value="Asesor general Mayorista">Asesor general Mayorista</option>
                    </select>
                    <p id="tipoAsesorError" class="error-message hidden">Este campo es obligatorio.</p>
                </div>
                <div class="mb-4">
                    <label for="nombreEmpresa"
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nombre de la
                        Empresa</label>
                    <input type="text" name="nombreEmpresa" id="nombreEmpresa"
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                </div>
                <div class="mb-4">
                    <label for="ciudad" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Ciudad
                        *</label>
                    <select name="ciudad" id="ciudad" required
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                        <option value="">Seleccione una ciudad</option>
                        <% cities.forEach(city=> { %>
                            <option value="<%= city.name %>">
                                <%= city.name %>
                            </option>
                            <% }); %>
                    </select>
                    <p id="ciudadError" class="error-message hidden">Este campo es obligatorio.</p>
                </div>
                <div class="mb-4">
                    <label for="nota"
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nota</label>
                    <textarea name="nota" id="nota" rows="3"
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white transition-colors"></textarea>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Imagen</label>
                    <div class="flex items-center space-x-4">
                        <label for="imagen"
                            class="cursor-pointer bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-white px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            <i class="fas fa-upload mr-2"></i> Seleccionar archivo
                        </label>
                        <input type="file" name="imagen" id="imagen" accept="image/*" class="hidden">
                        <span id="fileName" class="text-sm text-gray-500 dark:text-gray-400">Ningún archivo
                            seleccionado</span>
                    </div>
                    <div id="imagePreview" class="mt-4 hidden">
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Vista previa:</p>
                        <img id="previewImage" class="h-32 w-32 object-cover rounded shadow">
                    </div>
                </div>
                <div class="flex justify-end space-x-3 pt-4 border-t dark:border-gray-700">
                    <button id="cancelModalBtn" type="button"
                        class="bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white px-4 py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors">Cancelar</button>
                    <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors flex items-center">
                        <i class="fas fa-save mr-2"></i> Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div id="deleteModal"
        class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 fade-in">
        <div
            class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white dark:bg-gray-800 slide-down">
            <div class="flex justify-between items-center pb-4 border-b dark:border-gray-700">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Confirmar Eliminación</h3>
                <button id="closeDeleteModalIconBtn"
                    class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="mt-4">
                <div class="flex items-center justify-center mb-4 text-red-500">
                    <i class="fas fa-exclamation-triangle text-4xl"></i>
                </div>
                <p class="text-gray-600 dark:text-gray-300 mb-4 text-center">¿Estás seguro de eliminar al proveedor
                    <span id="deleteSupplierName" class="font-semibold"></span>?
                </p>
                <p class="text-sm text-gray-500 dark:text-gray-400 text-center mb-4">Esta acción no se puede deshacer.
                </p>
                <form id="deleteForm" action="/api/suppliers/:id" method="POST">
                    <div class="flex justify-end space-x-3 pt-4 border-t dark:border-gray-700">
                        <button id="cancelDeleteModalBtn" type="button"
                            class="bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white px-4 py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors">Cancelar</button>
                        <button type="submit"
                            class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition-colors flex items-center">
                            <i class="fas fa-trash mr-2"></i> Eliminar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="/js/suppliers.js"></script>
</body>

</html>